{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\OneDrive\\\\Desktop\\\\BusEase\\\\admin\\\\src\\\\context\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\n// AuthContext.js\nimport React, { createContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const navigate = useNavigate(); // Initialize user state from localStorage with safe parsing\n\n  const [user, setUser] = useState(() => {\n    if (typeof window !== 'undefined') {\n      // Check if window is available\n      const storedUser = localStorage.getItem('user');\n      return storedUser ? JSON.parse(storedUser) : null;\n    }\n\n    return null;\n  }); // Update localStorage whenever user changes\n\n  useEffect(() => {\n    if (user) {\n      localStorage.setItem('user', JSON.stringify(user));\n    } else {\n      localStorage.removeItem('user'); // Clear storage on logout\n    }\n  }, [user]);\n\n  const login = async credentials => {\n    try {\n      const {\n        data\n      } = await axios.post('/auth/login', credentials, {\n        withCredentials: true\n      });\n\n      if (data.isAdmin) {\n        // Include isAdmin in user state and store in localStorage\n        const userData = { ...data.details,\n          isAdmin: data.isAdmin\n        };\n        setUser(userData);\n        localStorage.setItem('user', JSON.stringify(userData)); // Persist user data\n\n        navigate('/admin'); // Redirect to admin page\n      } else {\n        alert('Access restricted to admin users only');\n      }\n    } catch (err) {\n      alert('Login failed. Please check your credentials.');\n      console.error(err);\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('user'); // Remove user data from localStorage\n\n    navigate('/login');\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 7\n  }, this);\n};\n\n_s(AuthProvider, \"OiDHVsabkF3Svfh2dEbOAtOHF0w=\", false, function () {\n  return [useNavigate];\n});\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/user/OneDrive/Desktop/BusEase/admin/src/context/AuthContext.js"],"names":["React","createContext","useState","useEffect","useNavigate","axios","AuthContext","AuthProvider","children","navigate","user","setUser","window","storedUser","localStorage","getItem","JSON","parse","setItem","stringify","removeItem","login","credentials","data","post","withCredentials","isAdmin","userData","details","alert","err","console","error","logout"],"mappings":";;;AAAA;AACA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,QAA/B,EAAyCC,SAAzC,QAA0D,OAA1D;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,OAAOC,KAAP,MAAkB,OAAlB;;AAEA,OAAO,MAAMC,WAAW,gBAAGL,aAAa,EAAjC;AAEP,OAAO,MAAMM,YAAY,GAAG,QAAkB;AAAA;;AAAA,MAAjB;AAAEC,IAAAA;AAAF,GAAiB;AAC5C,QAAMC,QAAQ,GAAGL,WAAW,EAA5B,CAD4C,CAG5C;;AACA,QAAM,CAACM,IAAD,EAAOC,OAAP,IAAkBT,QAAQ,CAAC,MAAM;AACnC,QAAI,OAAOU,MAAP,KAAkB,WAAtB,EAAmC;AAAG;AAClC,YAAMC,UAAU,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAnB;AACA,aAAOF,UAAU,GAAGG,IAAI,CAACC,KAAL,CAAWJ,UAAX,CAAH,GAA4B,IAA7C;AACH;;AACD,WAAO,IAAP;AACH,GAN+B,CAAhC,CAJ4C,CAY5C;;AACAV,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAIO,IAAJ,EAAU;AACNI,MAAAA,YAAY,CAACI,OAAb,CAAqB,MAArB,EAA6BF,IAAI,CAACG,SAAL,CAAeT,IAAf,CAA7B;AACH,KAFD,MAEO;AACHI,MAAAA,YAAY,CAACM,UAAb,CAAwB,MAAxB,EADG,CAC+B;AACrC;AACJ,GANQ,EAMN,CAACV,IAAD,CANM,CAAT;;AAQA,QAAMW,KAAK,GAAG,MAAOC,WAAP,IAAuB;AACjC,QAAI;AACA,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAMlB,KAAK,CAACmB,IAAN,CAAW,aAAX,EAA0BF,WAA1B,EAAuC;AAAEG,QAAAA,eAAe,EAAE;AAAnB,OAAvC,CAAvB;;AAEA,UAAIF,IAAI,CAACG,OAAT,EAAkB;AACd;AACA,cAAMC,QAAQ,GAAG,EAAE,GAAGJ,IAAI,CAACK,OAAV;AAAmBF,UAAAA,OAAO,EAAEH,IAAI,CAACG;AAAjC,SAAjB;AACAf,QAAAA,OAAO,CAACgB,QAAD,CAAP;AACAb,QAAAA,YAAY,CAACI,OAAb,CAAqB,MAArB,EAA6BF,IAAI,CAACG,SAAL,CAAeQ,QAAf,CAA7B,EAJc,CAI2C;;AACzDlB,QAAAA,QAAQ,CAAC,QAAD,CAAR,CALc,CAKO;AACxB,OAND,MAMO;AACHoB,QAAAA,KAAK,CAAC,uCAAD,CAAL;AACH;AACJ,KAZD,CAYE,OAAOC,GAAP,EAAY;AACVD,MAAAA,KAAK,CAAC,8CAAD,CAAL;AACAE,MAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACH;AACJ,GAjBD;;AAmBA,QAAMG,MAAM,GAAG,MAAM;AACjBtB,IAAAA,OAAO,CAAC,IAAD,CAAP;AACAG,IAAAA,YAAY,CAACM,UAAb,CAAwB,MAAxB,EAFiB,CAEiB;;AAClCX,IAAAA,QAAQ,CAAC,QAAD,CAAR;AACH,GAJD;;AAMA,sBACI,QAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAE;AAAEC,MAAAA,IAAF;AAAQW,MAAAA,KAAR;AAAeY,MAAAA;AAAf,KAA7B;AAAA,cACKzB;AADL;AAAA;AAAA;AAAA;AAAA,UADJ;AAKD,CAnDM;;GAAMD,Y;UACMH,W;;;KADNG,Y","sourcesContent":["// AuthContext.js\r\nimport React, { createContext, useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const navigate = useNavigate();\r\n\r\n  // Initialize user state from localStorage with safe parsing\r\n  const [user, setUser] = useState(() => {\r\n      if (typeof window !== 'undefined') {  // Check if window is available\r\n          const storedUser = localStorage.getItem('user');\r\n          return storedUser ? JSON.parse(storedUser) : null;\r\n      }\r\n      return null;\r\n  });\r\n\r\n  // Update localStorage whenever user changes\r\n  useEffect(() => {\r\n      if (user) {\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n      } else {\r\n          localStorage.removeItem('user');  // Clear storage on logout\r\n      }\r\n  }, [user]);\r\n\r\n  const login = async (credentials) => {\r\n      try {\r\n          const { data } = await axios.post('/auth/login', credentials, { withCredentials: true });\r\n\r\n          if (data.isAdmin) {\r\n              // Include isAdmin in user state and store in localStorage\r\n              const userData = { ...data.details, isAdmin: data.isAdmin };\r\n              setUser(userData);\r\n              localStorage.setItem('user', JSON.stringify(userData));  // Persist user data\r\n              navigate('/admin');  // Redirect to admin page\r\n          } else {\r\n              alert('Access restricted to admin users only');\r\n          }\r\n      } catch (err) {\r\n          alert('Login failed. Please check your credentials.');\r\n          console.error(err);\r\n      }\r\n  };\r\n\r\n  const logout = () => {\r\n      setUser(null);\r\n      localStorage.removeItem('user');  // Remove user data from localStorage\r\n      navigate('/login');\r\n  };\r\n\r\n  return (\r\n      <AuthContext.Provider value={{ user, login, logout }}>\r\n          {children}\r\n      </AuthContext.Provider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}